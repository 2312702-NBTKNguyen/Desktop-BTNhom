using System;
using System.Collections.Generic;
using System.Windows.Forms;
using CTK47B_BaiTapNhom_ThuVienQuanLySachCaNhan.Models;
using System.IO;

namespace CTK47B_BaiTapNhom_ThuVienQuanLySachCaNhan.Forms
{
 public partial class ImportForm : Form
 {
 public List<Book> ImportedBooks { get; private set; } = new List<Book>();
 public ImportForm()
 {
 InitializeComponent();
 }

 private void BtnBrowse_Click(object sender, EventArgs e)
 {
 using (var ofd = new OpenFileDialog())
 {
 ofd.Filter = "Text files|*.txt|All files|*.*";
 if (ofd.ShowDialog(this) != DialogResult.OK) return;
 txtPath.Text = ofd.FileName;
 LoadPreview(ofd.FileName);
 }
 }

 private void LoadPreview(string path)
 {
 try
 {
 var lines = File.ReadAllLines(path);
 var list = new List<Book>();
 foreach (var line in lines)
 {
 var parts = line.Split('|');
 if (parts.Length <6) continue;
 var b = new Book
 {
 Title = parts[0],
 Author = parts[1],
 Category = parts[2],
 PublishDate = DateTime.Parse(parts[3]),
 Publisher = parts[4],
 PageCount = int.Parse(parts[5]),
 AddedDate = DateTime.Now
 };
 list.Add(b);
 }
 dgvPreview.DataSource = list;
 }
 catch (Exception ex)
 {
 MessageBox.Show("Preview error: " + ex.Message);
 }
 }

 private void BtnImport_Click(object sender, EventArgs e)
 {
 if (string.IsNullOrWhiteSpace(txtPath.Text) || !File.Exists(txtPath.Text)) { MessageBox.Show("Select a valid file"); return; }
 try
 {
 var lines = File.ReadAllLines(txtPath.Text);
 foreach (var line in lines)
 {
 var parts = line.Split('|');
 if (parts.Length <6) continue;
 var b = new Book
 {
 Title = parts[0],
 Author = parts[1],
 Category = parts[2],
 PublishDate = DateTime.Parse(parts[3]),
 Publisher = parts[4],
 PageCount = int.Parse(parts[5]),
 AddedDate = DateTime.Now
 };
 ImportedBooks.Add(b);
 }
 this.DialogResult = DialogResult.OK;
 }
 catch (Exception ex)
 {
 MessageBox.Show("Import error: " + ex.Message);
 }
 }
 }
}
